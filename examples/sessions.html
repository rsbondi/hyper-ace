<!-- plunk: http://plnkr.co/edit/1BAWgE0wtKZmWlFKRcQg?p=preview -->
<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="../style.css" />
    <meta charset="utf-8">
</head>

<body>
<style type="text/css">
    .hyperace-session {
        font-size: 1.5em;
        margin: 5px 0;
        background: #efefef;
        padding: 2px;
        text-align: center;
        border: 1px solid;
    }
    #results {
        height: 400px;
        overflow: auto;
        border: 1px solid gray;
    }
    body, select {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size:12px;
        color: gray;
    }
</style>
<div id="editor"></div>
<div id="hyper">
    <label for="acemode">File:</label>
    <select name="acemode" id="acemode">
        <option value="hyper-ace.js">hyper-ace.js</option>
        <option value="sessions.html">sessions.html</option>
        <option value="style.css">style.css</option>
    </select>
    <p>This example shows the use of a search across multiple edit sessions.  Hit the [tab] key in the search box and the search
        will be performed accross all 3 files.  Otherwise, the search box functions as the ace default.
        Changing files with the selector will trigger a search on the selected file.
        Selecting a result will jump to the selection in the editor for appropriate file.  The source code for this example
        are the files loaded into the editor.</p>
    <div id="results"></div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://ace.c9.io/build/src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="../hyper-ace.js"></script>
<script>
    // create ace editor
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/eclipse");
    editor.getSession().setMode("ace/mode/javascript");
    editor.on("changeSession", function(e) {
        $('#acemode').val(e.session.tag);
    });
    var sessions = [];
    function createhyper(box) {
        hyperace.create(Array(editor), 'results', 'hyperbox'); // add hyper-ace editor, target and search box id created above
        hyperace.setSessions(sessions);
        box.addEventListener('keyup', function (e) { // look for tab key in search box
            if (e.keyCode == 9)
                hyperace.searchSessions();
        });
    }

    // undocumented ace function, used so we can initialize on callback of searchbox load to pass to hyper-ace
    ace.config.loadModule("ace/ext/searchbox", function(e) {
        e.Search(editor); // set to editor component
        var box = document.getElementById('editor').getElementsByClassName('ace_search_field')[0]; // get texbox element
        box.id = 'hyperbox'; // hyperace needs id, so we set it for the search box
        box.value = "result" // example that works in all 3 modes

        //$($('.ace_search_options').find('.ace_button')[0]).addClass('checked');

        var sessioncount = 0; // track for all 3 sessions loaded
        $.get('../hyper-ace.js', function(data) {
            editor.getSession().tag = 'hyper-ace.js';
            sessions['hyper-ace.js'] = editor.getSession();
            editor.getSession().setValue(data);
            sessioncount++;
            if (sessioncount == 3) createhyper(box);

        });
        $.get('sessions.html', function(data) {
            var session = new ace.EditSession(data, {
                "path": "ace/mode/xml"
            });
            session.tag = 'sessions.html';
            sessions['sessions.html'] = session;
            sessioncount++;
            if (sessioncount == 3) createhyper(box);
        });
        $.get('../style.css', function(data) {
            var session = new ace.EditSession(data, {
                "path": "ace/mode/css"
            });
            session.tag = 'style.css';
            sessions['style.css'] = session;
            sessioncount++;
            if (sessioncount == 3) createhyper(box);
        });
    });

    document.getElementById("acemode").addEventListener('change', function() {
        editor.setSession(sessions[this.value]);
        hyperace.search();
    });

</script>
</body>

</html>
