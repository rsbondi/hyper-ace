<!-- plunk: http://plnkr.co/edit/1BAWgE0wtKZmWlFKRcQg?p=preview -->
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../style.css"/>
    <meta charset="utf-8">
</head>

<body>
<style type="text/css">
    .hyperace-session {
        font-size: 1.5em;
        margin: 5px 0;
        background: #efefef;
        padding: 2px;
        text-align: center;
        border: 1px solid;    }
    #results {
        height: 400px;
        overflow: auto;
    }
</style>
<div id="editor"></div>
<div id="hyper">
    <label for="acemode">Session:</label>
    <select name="acemode" id="acemode">
        <option value="hyper-ace.js">javascript</option>
        <option value="sessions.html">html/xml</option>
        <option value="style.css">css</option>
    </select>
    <h3>Hypersearch with [tab] key in search box</h3>
    <div id="results"></div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="http://ace.c9.io/build/src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="../hyper-ace.js"></script>
<script>
    // create ace editor
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/eclipse");
    editor.getSession().setMode("ace/mode/javascript");
    var sessions = [];

    // undocumented ace function, used so we can initialize on callback of searchbox load to pass to hyper-ace
    ace.config.loadModule("ace/ext/searchbox", function(e) {
        e.Search(editor); // set to editor component
        var box = document.getElementById('editor').getElementsByClassName('ace_search_field')[0]; // get texbox element
        box.id = 'hyperbox'; // hyperace needs id, so we set it for the search box
        box.value = "\\b.+?:" // example that works in all 3 modes
        box.addEventListener('keyup', function (e) { // look for tab key in search box
            if (e.keyCode == 9)
                hyperace.searchSessions();
        });

        hyperace.create(Array(editor), 'results', 'hyperbox'); // add hyper-ace editor, target and search box id created above
        $($('.ace_search_options').find('.ace_button')[0]).addClass('checked');
        hyperace.set({"regExp": true});

    });

    document.getElementById("acemode").addEventListener('change', function () {
        editor.setSession(sessions[this.value]);
        hyperace.search();
    });

    $(function(){
        var sessioncount = 0; // track for all 3 sessions loaded
        $.get('../hyper-ace.js', function(data) {
            sessions['hyper-ace.js'] = editor.getSession();
            editor.getSession().setValue(data);
            sessioncount++;
            if(sessioncount==3) hyperace.setSessions(sessions);

        });
        $.get('sessions.html', function(data) {
            var session = new ace.EditSession(data, {"path": "ace/mode/xml"});
            sessions['sessions.html'] = session;
            sessioncount++;
            if(sessioncount==3) hyperace.setSessions(sessions);
        });
        $.get('../style.css', function(data) {
            var session = new ace.EditSession(data, {"path": "ace/mode/css"});
            sessions['style.css'] = session;
            sessioncount++;
            if(sessioncount) hyperace.setSessions(sessions);
        });
    });


</script>
</body>

</html>
